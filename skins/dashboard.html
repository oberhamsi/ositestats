<% extends './base.html' %>

<% subskin 'head' %>
<style>
   td {
      text-align:right;
      min-width: 40px;
   }
   th {
      text-align:right;
   }
</style>
<script type="text/javascript" src="/jquery.sparkline.js"></script>
<script>
   $(document).ready(function() {
      $('.sparkline').sparkline('html', {
      fillColor: 'blue',
	defaultPixelsPerValue: 2,
	minSpotColor: false,
	spotColor: false,});
      $('.counterlink').click(function() {
         var $link = $(this);
         $('textarea[site=' + $link.attr('site') + ']').toggle();
      });
   });
</script>

<% subskin 'content' %>

<h1> Dashboard</h1>

<% for site in <% sites %> render siteInfo %>

<i>Uniques, last 350 days

<!--
<div class="siteinfo">
   <h2> New Site </h2>
   <form method="POST">
      Site Name<br/>
      <input name="newSiteTitle" type="text"><br/>
      Domains (comma seperated)<br/>
      <input name="newSiteDomain" type="text" size=50><br/>
      <input value="create" type="submit"/>
   </form>
</div>
-->
<% subskin 'siteInfo' %>
<div style='text-align:center;background-color:#eeeeee;'>
   <form action="./stats/<% site.title %>" method="GET">
   <button type="submit"><% site.title %> →</button>
   </form>

   <p> 
    <span class='sparkline'> <% site.sparkValues %> </span><br/>
   <% site.sparkAvg %> Ø
   <br/> 
   <% site.sparkMax %> max
      <!---
      <a href="#" class="counterlink" site="<% site.title | escapeHtml %>">show counter code</a>
      <br/>
      <% render counterCode %>
      --->
   </p>
</div>
<% subskin 'counterCode' %>
<textarea id="code" site="<% site.title | escapeHtml %>" style="display:none" cols=80 rows=12>
 <script type="text/javascript">
   (function() {
     var stss = document.createElement('script');
     stss.type = 'text/javascript';
     stss.async = true;
     stss.src = '<% baseUri %>/hit/?referer=' + escape(document.referrer) +
          '&site=<% site.title | escapeHtml %>' +
          '&random=' + (new Date()).getTime();
     var s = document.getElementsByTagName('script')[0];
     s.parentNode.insertBefore(stss, s);
   })();
 </script>
</textarea>
